name: Attach Assets

on:
  workflow_dispatch:
    inputs:
      version:
        description: 'Version'
        required: false
        default: ''

jobs:
  attach-assets:
    name: Attach assets to release
    runs-on: ubuntu-latest
    env:
      GH_TOKEN: ${{ github.token }}

    steps:
      - uses: actions/checkout@v4
      - name: Determine version
        run: |
          if [ -z "${{ github.event.inputs.version }}" ]; then
            echo "No version specified, using latest draft"

            version=$(gh release list | grep Draft | head -n 1 | awk '{print $1}')
            echo "version=$version" >> "$GITHUB_OUTPUT"
          else
            echo "version=${{ github.event.inputs.version }}" >> "$GITHUB_OUTPUT"
          fi

      - name: Get build run
        run: |
          echo "build_run=$(gh run list --limit 1 --status completed --branch main | awk '{print $9}')" >> "$GITHUB_OUTPUT"

      - name: Debug
        run: |
          echo $GITHUB_OUTPUT
